
# this is a dynamic approach to discover all instance names based on available windows performance counter metrics. 
# custom libraries sed.exe, tr.exe, uniq.exe has been taken from https://desktop.github.com/ which is owned by microsoft https://news.microsoft.com/2018/06/04/microsoft-to-acquire-github-for-7-5-billion/
UserParameter=discover.mssql.dbs,typeperf -qx | find ":Databases(" | "C:\zabbix\zabbix_agentd.conf.d\sed.exe" "s/^\\\\/{\"{#INSTANCE}\":\"/;s/:Databases(/\",\"{#DBNAME}\":\"/;s/).*$/\"},/" | "C:\zabbix\zabbix_agentd.conf.d\sort.exe" | "C:\zabbix\zabbix_agentd.conf.d\uniq.exe" | "C:\zabbix\zabbix_agentd.conf.d\tr.exe" -cd "[:print:]" | "C:\zabbix\zabbix_agentd.conf.d\sed.exe" "s/^/{\"data\":[/;s/,$/]}/"
# zabbix_get -s 127.0.0.1 -p 10050 -k discover.mssql.dbs
# zabbix_get -s 127.0.0.1 -p 10050 -k discover.mssql.dbs | jq .

UserParameter=discover.mssql.instances,typeperf -qx | find ":Databases(" | "C:\zabbix\zabbix_agentd.conf.d\sed.exe" "s/^\\\\/{\"{#INSTANCE}\":\"/;s/:Databases(.*$/\"},/" | "C:\zabbix\zabbix_agentd.conf.d\sort.exe" | "C:\zabbix\zabbix_agentd.conf.d\uniq.exe" | "C:\zabbix\zabbix_agentd.conf.d\tr.exe" -cd "[:print:]" | "C:\zabbix\zabbix_agentd.conf.d\sed.exe" "s/^/{\"data\":[/;s/,$/]}/"
# zabbix_get -s 127.0.0.1 -p 10050 -k discover.mssql.instances
# zabbix_get -s 127.0.0.1 -p 10050 -k discover.mssql.instances | jq .
